MEDIA_ROOT = Path(os.getenv("MEDIA_ROOT", "gaiaeyes-media"))
FB_PAGE_ID = os.getenv("FB_PAGE_ID")
FB_ACCESS_TOKEN = os.getenv("FB_ACCESS_TOKEN")
IG_ID = os.getenv("IG_BUSINESS_ID") or os.getenv("IG_USER_ID")
GRAPH = "https://graph.facebook.com/v21.0"

def ig_post_photo(image_url, caption):
    create_url = f"{GRAPH}/{IG_ID}/media"
    payload = {
        "image_url": image_url,
        "caption": caption,
        "access_token": FB_ACCESS_TOKEN,
    }
    r = requests.post(create_url, data=payload)
    r.raise_for_status()
    container_id = r.json()["id"]

    publish = requests.post(f"{GRAPH}/{IG_ID}/media_publish", data={"creation_id": container_id, "access_token": FB_ACCESS_TOKEN})
    publish.raise_for_status()
    return publish.json()

def main():
    ...
    if tall and IG_ID:
        ...
          IG_POST_ID = ig_post_photo(tall_url, caption)
    ...

  fact-post:
    needs: fact-render
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with: { python-version: "3.11" }
      - run: pip install -r requirements.txt
      - name: Post fact to FB + IG
        env:
          MEDIA_ROOT: gaiaeyes-media
          FB_PAGE_ID: ${{ secrets.FB_PAGE_ID }}
          FB_ACCESS_TOKEN: ${{ secrets.FB_ACCESS_TOKEN }}
          IG_USER_ID: ${{ secrets.IG_USER_ID }}
        run: python bots/fact_overlay/social_poster.py